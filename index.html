<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de Modelo 3D en AR con Controles</title>
    <!-- Incluye la biblioteca A-Frame y AR.js -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/2.0.8/aframe/build/aframe-ar.js"></script>
</head>
<body>
    <a-scene embedded arjs>
        <!-- Configura la cámara con zoom -->
        <a-entity camera="zoom: 0.5;" look-controls></a-entity>

        <!-- Añade el modelo 3D GLB -->
        <a-entity gltf-model="#capo" scale="1 1 1"></a-entity>

        <!-- Modelo 3D GLB -->
        <a-assets>
            <a-asset-item id="capo" src="capo.glb"></a-asset-item>
        </a-assets>

        <!-- Controles de zoom y desplazamiento -->
        <a-entity id="controls">
            <!-- Zoom In -->
            <a-box position="-1.5 0 -2" color="green" scale="0.5 0.5 0.1" zoom-control="direction: in"></a-box>
            <!-- Zoom Out -->
            <a-box position="1.5 0 -2" color="red" scale="0.5 0.5 0.1" zoom-control="direction: out"></a-box>
            <!-- Desplazamiento Izquierda -->
            <a-box position="-0.5 0 -3" color="blue" scale="0.1 0.5 0.1" drag-control="direction: left"></a-box>
            <!-- Desplazamiento Derecha -->
            <a-box position="0.5 0 -3" color="yellow" scale="0.1 0.5 0.1" drag-control="direction: right"></a-box>
        </a-entity>

        <!-- Componente para controlar el zoom de la cámara -->
        <a-entity id="zoom-control" cursor-listener>
            <!-- Zoom In -->
            <a-box position="-1.5 0 -2" color="green" scale="0.5 0.5 0.1" zoom-control="direction: in"></a-box>
            <!-- Zoom Out -->
            <a-box position="1.5 0 -2" color="red" scale="0.5 0.5 0.1" zoom-control="direction: out"></a-box>
        </a-entity>

        <!-- Componente para controlar el desplazamiento -->
        <a-entity id="drag-control" cursor-listener>
            <!-- Desplazamiento Izquierda -->
            <a-box position="-0.5 0 -3" color="blue" scale="0.1 0.5 0.1" drag-control="direction: left"></a-box>
            <!-- Desplazamiento Derecha -->
            <a-box position="0.5 0 -3" color="yellow" scale="0.1 0.5 0.1" drag-control="direction: right"></a-box>
        </a-entity>

        <!-- Cursor -->
        <a-entity cursor="rayOrigin: mouse" raycaster="objects: [cursor-listener]"></a-entity>
    </a-scene>

    <script>
        // Añade un componente para controlar el zoom y el desplazamiento
        AFRAME.registerComponent('zoom-control', {
            schema: {
                direction: { type: 'string', default: 'in' }
            },
            init: function () {
                var el = this.el;
                var camera = document.querySelector('[camera]');
                var zoomSpeed = 0.1;

                el.addEventListener('click', function () {
                    if (camera) {
                        var currentZoom = camera.getAttribute('camera').zoom;

                        if (this.data.direction === 'in') {
                            camera.setAttribute('camera', 'zoom', currentZoom - zoomSpeed);
                        } else if (this.data.direction === 'out') {
                            camera.setAttribute('camera', 'zoom', currentZoom + zoomSpeed);
                        }
                    }
                });
            }
        });

        // Añade un componente para controlar el desplazamiento
        AFRAME.registerComponent('drag-control', {
            schema: {
                direction: { type: 'string', default: 'left' }
            },
            init: function () {
                var el = this.el;
                var isDragging = false;
                var previousPosition = { x: 0, y: 0 };

                el.addEventListener('mousedown', function (event) {
                    isDragging = true;
                    previousPosition.x = event.clientX;
                    previousPosition.y = event.clientY;
                });

                window.addEventListener('mousemove', function (event) {
                    if (!isDragging) return;

                    var deltaX = event.clientX - previousPosition.x;
                    var deltaY = event.clientY - previousPosition.y;

                    if (el.object3D && el.object3D.position) {
                        var currentPosition = el.object3D.position;

                        if (el.components && el.components.position && el.components.position.data) {
                            el.setAttribute('position', {
                                x: currentPosition.x + (deltaX / 100),
                                y: currentPosition.y - (deltaY / 100),
                                z: currentPosition.z
                            });
                        }
                    }

                    previousPosition.x = event.clientX;
                    previousPosition.y = event.clientY;
                });

                window.addEventListener('mouseup', function () {
                    isDragging = false;
                });
            }
        });

        // Añade un componente para escuchar eventos de cursor
        AFRAME.registerComponent('cursor-listener', {
            init: function () {
                var el = this.el;

                el.addEventListener('mouseenter', function () {
                    el.setAttribute('material', 'color', 'gray');
                });

                el.addEventListener('mouseleave', function () {
                    el.setAttribute('material', 'color', el.getAttribute('original-color'));
                });
            }
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de Modelo 3D en AR con Control de Zoom</title>
    <!-- Incluye la biblioteca A-Frame y AR.js -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/2.0.8/aframe/build/aframe-ar.js"></script>
</head>
<body>
    <a-scene embedded arjs>
        <!-- Ajusta la escala del modelo para que sea más grande -->
        <a-entity gltf-model="#capo" scale="1 1 1"></a-entity>

        <!-- Modelo 3D GLB -->
        <a-assets>
            <a-asset-item id="capo" src="capo.glb"></a-asset-item>
        </a-assets>
        
        <!-- Configura la cámara -->
        <a-entity id="camera" camera></a-entity>

        <!-- Añade un plano para capturar eventos de zoom -->
        <a-plane position="0 0 -5" rotation="-90 0 0" width="4" height="4" color="transparent" opacity="0.1" zoom-control></a-plane>
    </a-scene>

    <script>
        // Añade un componente para controlar el zoom
        AFRAME.registerComponent('zoom-control', {
            init: function () {
                // Escala inicial del modelo
                var initialScale = { x: 1, y: 1, z: 1 };
                
                // Establece el nivel de zoom inicial
                var zoomLevel = 1;

                // Registra el evento 'touchstart' para comenzar a rastrear el movimiento del dedo
                this.el.addEventListener('touchstart', function (event) {
                    // Obtiene la posición inicial del dedo
                    var startTouch = event.touches[0].clientY;

                    // Registra el evento 'touchmove' para ajustar el zoom mientras se mueve el dedo
                    window.addEventListener('touchmove', function (event) {
                        // Obtiene la posición actual del dedo
                        var currentTouch = event.touches[0].clientY;

                        // Calcula la diferencia en las posiciones
                        var delta = currentTouch - startTouch;

                        // Ajusta el nivel de zoom en función de la diferencia
                        zoomLevel += delta / 100;

                        // Ajusta la escala del modelo según el nivel de zoom
                        document.querySelector('[gltf-model="#capo"]').setAttribute('scale', {
                            x: initialScale.x * zoomLevel,
                            y: initialScale.y * zoomLevel,
                            z: initialScale.z * zoomLevel
                        });

                        // Actualiza la posición inicial para el próximo movimiento
                        startTouch = currentTouch;
                    });
                });

                // Registra el evento 'touchend' para dejar de rastrear el movimiento del dedo
                this.el.addEventListener('touchend', function () {
                    // Detiene el seguimiento del movimiento cuando se levanta el dedo
                    window.removeEventListener('touchmove');
                });
            }
        });
    </script>
</body>
</html>
